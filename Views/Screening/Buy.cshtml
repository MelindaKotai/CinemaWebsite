@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using Microsoft.Extensions.Options
@inject IOptions<Licenta.Services.StripeSettings> Stripe
@model Licenta.ViewModels.ChooseSeatsViewModel;
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <div class="row">
        <div class="col-sm-6 " style="padding-top:100px;">
            <b style="font-size:30px">Detalii plata</b> 
            <br />
            Nume: @Model.nume
            <br />
            Prenume: @Model.prenume
            <br />
            Email: @Model.email
            <br />
            Telefon: @Model.telefon
            <br />
            Numar de bilete: @Model.notickets
            <br />

            <br />
            <b style="font-size:30px">Total:@Model.total lei</b>



        </div>

        <div class=" col-sm-6 form p-5">
            <i class="fa fa-cc-stripe" style="font-size:36px"></i>
            <i class="fa fa-cc-visa" style="font-size:36px"></i>
            <i class="fa fa-cc-mastercard" style="font-size:36px"></i>
            <i class="fa fa-cc-amex" style="font-size:36px"></i>
            <script src="https://js.stripe.com/v3/"></script>
            <br />
            <br />
            <form asp-action="Charge" asp-controller="Screening" method="POST" id="payment-form">
                <input asp-for="selectedseats" type="hidden" />
                <input asp-for="screeningId" type="hidden" />
                <input asp-for="userId" type="hidden" />
                <input asp-for="nume" type="hidden" />
                <input asp-for="prenume" type="hidden" />
                <input asp-for="email" type="hidden" />
                <input asp-for="telefon" type="hidden" />
                <input asp-for="action" type="hidden" />
           

                Numarul cardului:
                <span id="card-number" class="form-control"></span>
                CVC:
                <span id="card-cvc" class="form-control"></span>
                Data expirarii:
                <span id="card-exp" class="form-control"></span>

                <input asp-for="Token" class="StripeToken" hidden />
                <input type="hidden" name="action" value="Rezerva biletele" />
                <br />

                <button class="btn btn-danger">Plateste</button>
                <div id="card-errors" role="alert" class="text-danger"></div>
            </form>


        </div>


    </div>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script type="text/javascript">

    $(document).ready(function () {
        var stripe = Stripe('pk_test_51ImDqrLWDtGNpb5wYXykPzGz15FQ4M2iwfn5GrNeau9cuKJgbtlU1S78OAeGmrYaleSc0NGDkfW5PiHdeCM3673c00MH5Ucd4N');

        var elements = stripe.elements();


        var style = {
            base: {

                'lineHeight': '1.35',
                'fontSize': '1.11rem',
                'color': '#495057',
                'fontFamily': 'apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif'
            }
        };

        var card = elements.create('cardNumber', { 'placeholder': '1234 1234 1234 1234', 'style': style });
        card.mount("#card-number");

        var cvc = elements.create('cardCvc', { 'placeholder': 'yyy', 'style': style });
        cvc.mount("#card-cvc");

        var exp = elements.create('cardExpiry', { 'placeholder': 'xx/xx', 'style': style });
        exp.mount("#card-exp");

        var form = document.getElementById('payment-form');
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            stripe.createToken(card).then(function (result) {
                if (result.error) {
                    var errorElement = element.getElementById("card-errors");
                    errorElement.textContent = result.error.message;
                } else {
                    stripeTokenHandler(result.token);
                    console.log(result.token);
                }
            });
        });

        function stripeTokenHandler(token) {
            $(".StripeToken").val(token.id);
            form.submit();
        }
    });


</script>